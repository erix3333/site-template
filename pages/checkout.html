<script src="../app.js"></script>
<script>
  // --- Replace previous submit logic with a real Stripe Checkout redirect ---
  const cart = JSON.parse(localStorage.getItem('cart')||'{}');
  if (!Object.keys(cart).length) {
    location.href = '../index.html#products';
  }

  // keep your existing summary render if you like â€“ not required for redirect
  document.getElementById('checkoutForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { alert('Please complete required fields.'); return; }

    // Pack minimal contact (optional)
    const data = Object.fromEntries(new FormData(form));
    const payload = { items: cart, contact: { email: data.email } };

    try {
      const res = await fetch('/api/create-checkout-session', {
        method:'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });
      const out = await res.json();
      if (!res.ok) throw new Error(out.error || 'Failed to start checkout');

      // Redirect to Stripe
      window.location.href = out.url;
    } catch (err) {
      alert('Checkout failed: ' + err.message);
      console.error(err);
    }
  });

  // tiny: update year
  document.getElementById('year').textContent = new Date().getFullYear();
</script>
